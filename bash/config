#!/bin/bash

set -o emacs

# History
shopt -s histappend

# homebrew bash completion
if [ -f "$(brew --prefix)/etc/bash_completion" ]; then
    # shellcheck source=/dev/null
    . "$(brew --prefix)/etc/bash_completion"
fi

# git bash completion
if [ -f etc/git-completion.bash ]; then
    # shellcheck source=/dev/null
    source etc/git-completion.bash
fi

#AWS CLI completion
complete -C aws_completer aws

# SSH keys

add-ssh-keys() {
    for key in "$HOME"/.ssh/*
    do
        [[ "$key" =~ .*(.csv|.pub|known_hosts|authorized_keys|youtube_publishing_key.pub|youtube_publishing_key|yt_publishing_key.ppk)$ ]] && continue
        ssh-add "$key" &>/dev/null
    done
}

ssh-add -l &>/dev/null
if [ "$?" == 2 ]; then
    test -r ~/.ssh-agent && \
        eval "$(<~/.ssh-agent)" >/dev/null

    ssh-add -l &>/dev/null
    if [ "$?" == 2 ]; then
        (umask 066; ssh-agent > ~/.ssh-agent)
        eval "$(<~/.ssh-agent)" >/dev/null
        add-ssh-keys
    fi
fi

# GO
export GOPATH=$HOME/code/go
export PATH=$PATH:$GOPATH/bin
